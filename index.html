<!doctype html>

<html>

<head>
	<meta charset='utf-8'>
	<title> war game idea </title>
	 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script>
</head>

<style>
	#title{
		text-align: center;
		display: inline-block;
		vertical-align: top;
	}
	body, html{
		font-family: Arial;
	}
	#header{
		text-align: center;
			margin-bottom: 10px;
	}
	#enemyInfo, #playerOptions{
		display: inline-block;
	}
	#playerOptions{
		margin-left: 50px;
	}
	#grid{
		position: relative;
		border: 1px solid #000;
		background-image: url('mapedit.png');
		background-size: 100% 100%;
		padding: 0;
		margin: 0 auto;
	}
	#showCards{
		display: block;
		position: relative;
		width: 100%;
		height: auto;
		text-align: center;
	}
	.card{
		display: inline-block;
		vertical-align: top;
		height: 400px;
		width: 250px;
		border-radius: 20px;
		border: 1px solid #000;
		margin-left: 20px;
		text-align: center;
	}
	#footer{
		display: block;
		position: relative;
		margin-top: 5%;
		height: 20px;
		width: 100%;
		text-align: center;
	}
	button{
		border-radius: 7px;
		background-color: #cccddd;
		box-shadow: 1px 1px 1px 1px gray;
	}

</style>

<body>

<div id='header'>
	<div id='enemyInfo'>
		<h3> enemy info </h3>
		<span><img id='selectedEnemy' src=''></span>
		<h3> enemy health: <span id='enemyHealth'></span> </h3>
		<br>
	</div>
	
	<div id='title'>
		<h3> war game idea </h3>
		<p> click on the cat on the grid to move. </p>
		<p> click on an adjacent enemy unit to do damage, or on any enemy unit to get info. </p> 
		<p> click on 'draw cards' to get some new abilities. </p>
		<p>'end turn' causes the enemies to move and possibly do damage to you. </p>
	</div>
	
	<div id='playerOptions'>
		<h3> player info </h3>
		<span><img src='nyasu7.png' id='player' width='100px' height='90px'></img></span> 
		<h3> player's health: <span id='playerHealth'> 100 </span></h3>
		<button id='drawCards'> draw cards </button>
		<button id='endTurn'> end turn </button>
	</div>
</div>

<div id='grid'>
</div>

<div id='showCards'>
	<h3> cards go here </h3>
	
	<div id='currentCards'>
		<div class ='card' id='deck'>
			<h2> hi i'm the deck </h2>
		</div>
		
		<div class ='card' id='card1'>
			<div id='card1title'></div>
			<div> <img id='card1pic'></img> </div>
			<div id='card1description'></div>
		</div>
		
		<div class ='card' id='card2'>
			<div id='card2title'></div>
			<div> <img id='card2pic'></img> </div>
			<div id='card2description'></div>
		</div>
		
		<div class ='card' id='card3'>
			<div id='card3title'></div>
			<div> <img id='card3pic'></img> </div>
			<div id='card3description'></div>
		</div>
	</div>
	
</div>

<div id='footer'>
	<p> 2017 | <a href='https://github.com/syncopika/war_games'>source</a> </p>
</div>

</body>


<script type="module">
// note: using modules enforces strict mode! 
/*
	notes:
	there should be an html attribute assigned to specify unit name/type. 
	
	TODO:

	- UPDATE enemyAI.js 
	- attach enemyAI functions to button via eventListener, not in line 
	- create separate modules for each unique card 
	- bundle modules to import as one? 
	- use typescript to generate classes for card and deck 
	
*/

import { Game } from "./scripts/Game.js";
import { enemyMovement } from "./scripts/enemyAI.js";
import { CompleteDomination } from "./scripts/cards/card1.js";
import { PancakeSniper } from "./scripts/cards/card2.js";
import { BearAttack } from "./scripts/cards/card3.js";


/****   start game here  *****/

// set up map 
let length = 36;
let height = 15;

let gameInstance = new Game();
gameInstance.createGrid(length, height);


// set up units initially 
initialState(length, height);


// hook up end turn button with enemyTurn function 
document.getElementById('endTurn').addEventListener('click', function(){
	gameInstance.enemyTurn(enemyMovement);
});


// load player's deck 
let playerDeck = gameInstance.playerDeck();
playerDeck.add(BearAttack);
playerDeck.add(CompleteDomination);
playerDeck.add(PancakeSniper);


// hook up end draw cards button with drawCards function 
document.getElementById('drawCards').addEventListener('click', function(){
	gameInstance.playerDeck().drawCards(gameInstance);
});


/***************************/



/*****

	initiate first state of game 

******/
function initialState(length, height){
	
	// randomly place nyasu 
	// function placeRandom(element, health, attack, leftBound, rightBound, bottomBound, topBound, stats)
	gameInstance.placeRandom("nyasu7.png", length - 10, length, 0, height, {'health': 100, 'attack': 20, 'className': 'player', 'unitType': 'boss'});
	
	// place enemies 
	for(let i = 0; i < 10; i++){
		gameInstance.placeRandom("shiina2.png", 0, length, 0, height, {'health': 20, 'attack': 5, 'className': 'enemy', 'unitType': 'infantry'});
	}
	
	// place enemy boss
	gameInstance.placeRandom("umaruchan.png", 0, 10, 0, height, {'health': 50, 'attack': 5, 'className' : 'enemy', 'unitType': 'boss'});
	
}

// add event listener to document to be able to click on enemy units and get some info 
// what if selected enemy unit gets killed and their info was present? delete that info? 
// if so, then maybe add an attribute for 'selectedEnemy' that wil equal the DOM element 
// of the selected enemy. in the function where player attacks enemy, if enemy dies, check
// 'selectedEnemy' attribute if it was that enemy. 
document.addEventListener('click', function(e){
	if(e.target.className === "enemy"){
		let start = e.target.style.backgroundImage.indexOf("(") + 2;  // inclusive 
		let end = e.target.style.backgroundImage.indexOf(")") - 1;   // not inclusive
		let imgSrc = e.target.style.backgroundImage.substring(start, end);
		document.getElementById('selectedEnemy').setAttribute('src', imgSrc);
		document.getElementById('selectedEnemy').setAttribute('width', 100);
		document.getElementById('selectedEnemy').setAttribute('height', 90);
		document.getElementById('enemyHealth').textContent = e.target.getAttribute("health");
	}
});

	
</script>

</html>
