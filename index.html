<!doctype html>

<html>

<head>
	<meta charset='utf-8'>
	<title> 2d turn-based war game idea </title>
	<!-- 
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
	-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script>
	<script src="https://unpkg.com/react@16.4.1/umd/react.production.min.js"></script>
	<script src="https://unpkg.com/react-dom@16.4.1/umd/react-dom.production.min.js"></script>
</head>

<style>
	#title{
		text-align: center;
		display: inline-block;
		vertical-align: top;
	}
	body, html{
		font-family: Arial;
	}
	#header{
		text-align: center;
			margin-bottom: 10px;
	}
	#enemyInfo, #playerOptions{
		display: inline-block;
	}
	#playerOptions{
		margin-left: 50px;
	}
	#grid{
		position: relative;
		border: 1px solid #000;
		/*background-image: url('mapedit.png');*/
		background-color:  #cccddd;
		background-size: 100% 100%;
		padding: 0;
		margin: 0 auto;
	}
	#showCards{
		display: block;
		position: relative;
		width: 100%;
		height: auto;
		text-align: center;
	}
	.card{
		display: inline-block;
		vertical-align: top;
		height: 400px;
		width: 250px;
		border-radius: 20px;
		border: 1px solid #000;
		margin-left: 20px;
		text-align: center;
	}
	#footer{
		display: block;
		position: relative;
		margin-top: 5%;
		height: 20px;
		width: 100%;
		text-align: center;
	}
	button{
		border-radius: 7px;
		background-color: #cccddd;
		box-shadow: 1px 1px 1px 1px gray;
	}

</style>

<body>

<div id='header'>
	<div id='enemyInfo'>
		<h3> enemy info </h3>
		<span><img id='selectedEnemy' src=''></span>
		<h3> enemy health: <span id='enemyHealth'></span> </h3>
		<br>
	</div>
	
	<div id='title'>
		<h3> 2d turn-based war game idea </h3>
		<p> click on the cat on the grid to move. </p>
		<p> click on an adjacent enemy unit to do damage, or on any enemy unit to get info. </p> 
		<p> click on 'draw cards' to get some new abilities. </p>
		<p>'end turn' causes the enemies to move and possibly do damage to you. </p>
	</div>
	
	<div id='playerOptions'>
		<h3> player info </h3>
		<span><img src='./assets/nyasu7.png' id='player' width='100px' height='90px'></img></span> 
		<h3> player's health: <span id='playerHealth'> 100 </span></h3>
		<button id='drawCards'> draw cards </button>
		<button id='endTurn'> end turn </button>
	</div>
</div>

<div id='grid'>
</div>

<br>

<div id='console'>
</div>

<br>

<div id='showCards'>	
</div>


<div id='footer'>
	<p> 2017-2019 | <a href='https://github.com/syncopika/war_games'>source</a> </p>
</div>

</body>


<script type="module" >
// note: using modules enforces strict mode! 
/*
	notes:
	there should be an html attribute assigned to specify unit name/type. 
	
	// https://www.valentinog.com/blog/react-webpack-babel/
	
	TODO:

	- UPDATE enemyAI.js 
	- attach enemyAI functions to button via eventListener, not in line 
	- create separate modules for each unique card 
	- bundle modules to import as one? webpack?
	- make all components React components?
	- add a reporter at the bottom of the page - i.e. a console that records all the actions during the game 
	
	https://stackoverflow.com/questions/29149169/how-to-loop-and-render-elements-in-react-js-without-an-array-of-objects-to-map
	https://stackoverflow.com/questions/27290013/how-to-render-multiple-children-without-jsx
	
	
	thought of something:
	it would make sense for cards to be deativated (and cleared from the screen) after use, but how to do that?
	for example, if I'm supposed to place a unit, as soon as I click activate the card (and its description) could disappear, 
	but what if I was still reading the card? also, can I cancel? 
	
	if we want to clear the card after placing the unit, I have to somehow set a current state like 'activatedCard' and 
	listen for some change on the grid (i.e. placing a unit). then I can clear the card. 
	
	to show some effects when dealing damage:
	this looks cool https://opengameart.org/content/hit-animation-2-frame-by-frame
	http://www.williammalone.com/articles/create-html5-canvas-javascript-sprite-animation/

	for testing:
	https://blog.scottlogic.com/2018/01/08/pros-cons-e2e-testing-tools.html
	
	convert Game to a React component? 
	when card is activated, should we have a message passed as a prop from the card to the hand to the game?
	card activated -> send msg to hand -> hand sends msg to Game -> Game rerenders console with new msg 
	
*/

import { Game } from "./scripts/Game.js";
import { GameConsole } from "./scripts/GameConsole.js";
import { enemyMovement } from "./scripts/enemyAI.js";
import { CompleteDomination } from "./scripts/cards/card1.js";
import { PancakeSniper } from "./scripts/cards/card2.js";
import { BearAttack } from "./scripts/cards/card3.js";


/****   start game here  *****/

// set up map 
let length = 36;
let height = 15;

let gameInstance = new Game();
gameInstance.consoleElement = document.getElementById('console');
gameInstance.createGrid(length, height, document.getElementById('grid'));
//gameInstance.createGrid2(length, height);

// set up units initially 
initialState(length, height);


// hook up end turn button with enemyTurn function 
document.getElementById('endTurn').addEventListener('click', function(){
	gameInstance.enemyTurn(enemyMovement);
});


// load player's deck 
let playerDeck = gameInstance.playerDeck;
playerDeck.add(BearAttack);
playerDeck.add(CompleteDomination);
playerDeck.add(PancakeSniper);


// hook up end draw cards button with drawCards function 
document.getElementById('drawCards').addEventListener('click', function(){
	gameInstance.drawCards();
});

/***************************/



/*****

	initiate first state of game 

******/
function initialState(length, height){
	
	// randomly place nyasu 
	// function placeRandom(element, health, attack, leftBound, rightBound, bottomBound, topBound, stats)
	gameInstance.placeRandom("./assets/nyasu7.png", length - 10, length, 0, height, {'health': 100, 'attack': 20, 'className': 'player', 'unitType': 'boss'});
	
	// place enemies 
	for(let i = 0; i < 10; i++){
		gameInstance.placeRandom("./assets/shiina2.png", 0, length, 0, height, {'health': 20, 'attack': 5, 'className': 'enemy', 'unitType': 'infantry'});
	}
	
	// place enemy boss
	gameInstance.placeRandom("./assets/umaruchan.png", 0, 10, 0, height, {'health': 50, 'attack': 5, 'className' : 'enemy', 'unitType': 'boss'});
	
	// place obstacles
	for(let i = 0; i < 15; i++){
		gameInstance.placeObstacles(0, length, 0, height);
	}
}

// add event listener to document to be able to click on enemy units and get some info 
// what if selected enemy unit gets killed and their info was present? delete that info? 
// if so, then maybe add an attribute for 'selectedEnemy' that wil equal the DOM element 
// of the selected enemy. in the function where player attacks enemy, if enemy dies, check
// 'selectedEnemy' attribute if it was that enemy. 
document.addEventListener('click', function(e){
	if(e.target.className === "enemy"){
		let start = e.target.style.backgroundImage.indexOf("(") + 2;  // inclusive 
		let end = e.target.style.backgroundImage.indexOf(")") - 1;   // not inclusive
		let imgSrc = e.target.style.backgroundImage.substring(start, end);
		document.getElementById('selectedEnemy').setAttribute('src', imgSrc);
		document.getElementById('selectedEnemy').setAttribute('width', 100);
		document.getElementById('selectedEnemy').setAttribute('height', 90);
		document.getElementById('enemyHealth').textContent = e.target.getAttribute("health");
	}
});

	
</script>

</html>
